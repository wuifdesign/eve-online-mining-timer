{"version":3,"sources":["timer.js"],"names":["$","configData","parseScanResult","result","scan_data","each","split","index","element","scanElement","elementPart","length","label","count","parseInt","replace","ore","type","toLowerCase","push","err","Vue","filter","value","minutes","Math","floor","seconds","round","toString","data","number","substr","add","slice","read","val","write","oldVal","isNaN","component","template","props","Object","current_ship","settings","yield_per_sec_m3","Number","remove-task","Function","required","add-cargo","turrets","turrets_select","running","select","interval","created","self","this","$on","stop","updateTurretData","watch","computed","ore_size","size","total_ore_size","ore_per_sec","yield_per_turret","circles","isFinite","time","circle_time","methods","i","split_turrets","start","setInterval","oreCount","addCargo","task_sound","play","clearInterval","remove","removeTask","initApp","miningApp","el","cargo","scanner_data","current_ship_index","ships","ships_list","cargo_limit","cargo_full_sound","tasks","localStorage","getItem","stored_ships","addEmptyShip","JSON","parse","ship_count","removeItem","setItem","ship","name","key","yield_per_sec","max_cargo","cargo_nearly_full","cargo_full","$broadcast","full_cargo_time","saveSettings","stringify","saveShips","removeShip","$remove","addEmptyTask","add_yield","playSound","sound","resetCargo","task","removeEmptyTasks","setTimeout","parseScannerData","getJSON","jQuery"],"mappings":"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","file":"main.min.js","sourcesContent":["(function ($) {\r\n    'use strict';\r\n\r\n    var configData;\r\n\r\n    var parseScanResult = function (result) {\r\n        var scan_data = [];\r\n        $.each(result.split('\\n'), function (index, element) {\r\n            try {\r\n                var scanElement = {};\r\n                var elementPart = element.split('\\t');\r\n\r\n                if (elementPart.length != 3) {\r\n                    throw 'shorter 3';\r\n                }\r\n\r\n                scanElement.label = elementPart[0] + ' - ' + elementPart[2];\r\n                scanElement.count = parseInt(elementPart[1].replace(/\\u00a0/g, '').replace('.', '').replace(',', ''));\r\n\r\n                var type = elementPart[0].split(' ');\r\n                var ore;\r\n\r\n                if (type.length > 1) {\r\n                    ore = type[1].toLowerCase();\r\n                } else {\r\n                    ore = type[0].toLowerCase();\r\n                }\r\n\r\n                if (ore === 'ochre') {\r\n                    ore = 'dark ochre';\r\n                } else if (ore === 'arisite') {\r\n                    ore = 'green arisite';\r\n                }\r\n\r\n                scanElement.ore = ore;\r\n                scan_data.push(scanElement);\r\n            } catch (err) {\r\n            }\r\n        });\r\n        return scan_data;\r\n    };\r\n\r\n    Vue.filter('time', function (value) {\r\n        var minutes = Math.floor((value / 60));\r\n        var seconds = value - (minutes * 60);\r\n        if (minutes < 10) {\r\n            minutes = '0' + minutes;\r\n        }\r\n        if (seconds < 10) {\r\n            seconds = '0' + seconds;\r\n        }\r\n        return minutes + ':' + seconds;\r\n    });\r\n\r\n    Vue.filter('number', function (value) {\r\n        return Math.round(value).toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\r\n    });\r\n\r\n    Vue.filter('toFixed', function (value) {\r\n        var data = Math.round(value * 100).toString();\r\n        var number = data.substr(0, data.length-2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\r\n        var add = Math.round(data.slice(-2));\r\n        if(number === '') { number = 0; }\r\n        if(add < 10) { add = '0' + add; }\r\n        return number + '.' + add;\r\n    });\r\n\r\n    Vue.filter('round', {\r\n        read: function(val) {\r\n            return Math.round(val);\r\n        },\r\n        write: function(val, oldVal) {\r\n            return isNaN(val) ? 0 : Math.round(val);\r\n        }\r\n    });\r\n\r\n    Vue.component('task-row', {\r\n        template: '#grid-template',\r\n        replace: true,\r\n        props: {\r\n            data: Object,\r\n            current_ship: Object,\r\n            settings: Object,\r\n            yield_per_sec_m3: Number,\r\n            'remove-task': {\r\n                type: Function,\r\n                required: true\r\n            },\r\n            'add-cargo': {\r\n                type: Function,\r\n                required: true\r\n            }\r\n        },\r\n        data: function () {\r\n            return {\r\n                turrets: 1,\r\n                turrets_select: [],\r\n                running: false,\r\n                select: configData['select'],\r\n                interval: null\r\n            };\r\n        },\r\n        created: function () {\r\n            var self = this;\r\n            this.$on('stop-tasks', function() {\r\n                self.stop();\r\n            });\r\n            this.updateTurretData();\r\n        },\r\n        watch: {\r\n            current_ship: function(val) {\r\n                this.updateTurretData();\r\n            }\r\n        },\r\n        computed: {\r\n            ore_size: function () {\r\n                if (this.data.ore === '') {\r\n                    return 0;\r\n                }\r\n                return configData.size[this.data.ore];\r\n            },\r\n            total_ore_size: function () {\r\n                if (isNaN(this.data.count)) {\r\n                    return 0;\r\n                }\r\n                return Math.round(this.data.count * this.ore_size);\r\n            },\r\n            ore_per_sec: function () {\r\n                var yield_per_turret = this.yield_per_sec_m3 / this.ore_size / this.current_ship.turrets\r\n                return yield_per_turret * this.turrets;\r\n            },\r\n            circles: function () {\r\n                var circles = this.total_ore_size / this.current_ship.yield_per_turret / this.turrets;\r\n                return isNaN(circles) || !isFinite(circles) ? 0 : circles;\r\n            },\r\n            time: function () {\r\n                var time =  Math.round(this.circles * this.current_ship.circle_time);\r\n                return isNaN(time) ? 0 : time;\r\n            }\r\n        },\r\n        methods: {\r\n            updateTurretData: function () {\r\n                if(this.current_ship !== null) {\r\n                    this.turrets_select = [];\r\n                    for(var i = 1; i <= this.current_ship.turrets; i++) {\r\n                        this.turrets_select.push(i);\r\n                    }\r\n                    if(this.current_ship.split_turrets) {\r\n                        this.turrets = 1;\r\n                    } else {\r\n                        this.turrets = this.current_ship.turrets;\r\n                    }\r\n                }\r\n\r\n            },\r\n            start: function () {\r\n                if (this.time <= 0) {\r\n                    return;\r\n                }\r\n                var self = this;\r\n                this.interval = setInterval(function () {\r\n                    var oreCount = self.ore_per_sec;\r\n                    if (self.data.count < self.ore_per_sec) {\r\n                        oreCount = self.data.count;\r\n                    }\r\n                    self.data.count -= self.ore_per_sec;\r\n                    self.addCargo(oreCount * self.ore_size);\r\n                    if (self.data.count <= 0) {\r\n                        $('#' + self.settings.task_sound)[0].play();\r\n                        self.data.count = 0;\r\n                        self.stop();\r\n                    }\r\n                }, 1000);\r\n                this.running = true;\r\n            },\r\n            stop: function () {\r\n                clearInterval(this.interval);\r\n                this.interval = null;\r\n                this.running = false;\r\n            },\r\n            remove: function () {\r\n                this.removeTask(this.data);\r\n            }\r\n        }\r\n    });\r\n\r\n    var initApp = function () {\r\n        var miningApp = new Vue({\r\n            el: '#mining-app',\r\n            data: {\r\n                cargo: 0,\r\n                scanner_data: '',\r\n                current_ship_index: null,\r\n                ships: [],\r\n                ships_list: [],\r\n                settings: {\r\n                    cargo_limit: 95,\r\n                    task_sound: 'sound-1',\r\n                    cargo_full_sound: 'sound-1'\r\n                },\r\n                tasks: []\r\n            },\r\n            created: function () {\r\n                this.current_ship_index = localStorage.getItem('current_ship_index');\r\n\r\n                var stored_ships = localStorage.getItem('ships');\r\n                if (stored_ships === null) {\r\n                    this.addEmptyShip();\r\n                } else {\r\n                    this.ships = JSON.parse(stored_ships);\r\n                }\r\n\r\n                var settings = localStorage.getItem('settings');\r\n                if (settings !== null) {\r\n                    this.settings = JSON.parse(settings);\r\n                }\r\n            },\r\n            watch: {\r\n                ship_count: function (val) {\r\n                    if(val > 0 && this.current_ship_index === null) {\r\n                        this.current_ship_index = 0;\r\n                    } else if (val == 0) {\r\n                        this.current_ship_index = null;\r\n                        localStorage.removeItem('current_ship_index');\r\n                    }\r\n                },\r\n                current_ship_index: function (val) {\r\n                    if (typeof val !== 'undefined') {\r\n                        localStorage.setItem('current_ship_index', val);\r\n                    }\r\n                }\r\n            },\r\n            computed: {\r\n                current_ship: function () {\r\n                    var ship = this.ships[this.current_ship_index];\r\n                    if (typeof ship === 'undefined') {\r\n                        return {\r\n                            name: '',\r\n                            cargo: 0,\r\n                            yield_per_turret: 0,\r\n                            circle_time: 0,\r\n                            turrets: 1,\r\n                            split_turrets: false\r\n                        };\r\n                    }\r\n                    return ship;\r\n                },\r\n                ship_count: function () {\r\n                    var count = 0;\r\n                    $.each(this.ships, function(key, value) {\r\n                        if(value.name !== '') {\r\n                            count++;\r\n                        }\r\n                    });\r\n                    return count;\r\n                },\r\n                yield_per_sec_m3: function () {\r\n                    var yield_per_sec = (this.current_ship.yield_per_turret * this.current_ship.turrets) / this.current_ship.circle_time;\r\n                    return isNaN(yield_per_sec) ? 0 : yield_per_sec;\r\n                },\r\n                max_cargo: function () {\r\n                    return this.current_ship.cargo;\r\n                },\r\n                cargo_nearly_full: function () {\r\n                    if (this.current_ship.cargo === 0) {\r\n                        return false;\r\n                    }\r\n                    return this.cargo >= this.current_ship.cargo * (this.settings.cargo_limit / 100);\r\n                },\r\n                cargo_full: function () {\r\n                    if (this.current_ship.cargo === 0) {\r\n                        return false;\r\n                    }\r\n                    if(this.cargo >= this.current_ship.cargo) {\r\n                        this.$broadcast('stop-tasks');\r\n                        $('#' + this.settings.cargo_full_sound)[0].play();\r\n                        return true;\r\n                    }\r\n                    return false;\r\n                },\r\n                full_cargo_time: function () {\r\n                    var time = Math.round(this.current_ship.cargo / this.yield_per_sec_m3);\r\n                    return isNaN(time) ? 0 : time;\r\n                }\r\n            },\r\n            methods: {\r\n                saveSettings: function () {\r\n                    localStorage.setItem('settings', JSON.stringify(this.settings));\r\n                },\r\n                addEmptyShip: function () {\r\n                    this.ships.push({\r\n                        name: '',\r\n                        cargo: 0,\r\n                        yield_per_turret: 0,\r\n                        circle_time: 0,\r\n                        turrets: 1\r\n                    });\r\n                },\r\n                saveShips: function () {\r\n                    localStorage.setItem('ships', JSON.stringify(this.ships));\r\n                },\r\n                removeShip: function (ship) {\r\n                    this.ships.$remove(ship);\r\n                    this.saveShips();\r\n                },\r\n                addEmptyTask: function () {\r\n                    this.tasks.push({\r\n                        label: '',\r\n                        ore: 'veldspar',\r\n                        count: 0\r\n                    })\r\n                },\r\n                addCargo: function (add_yield) {\r\n                    this.cargo += add_yield;\r\n                },\r\n                playSound: function (sound) {\r\n                    $('#' + sound)[0].play();\r\n                },\r\n                resetCargo: function () {\r\n                    this.cargo = 0;\r\n                },\r\n                removeTask: function (task) {\r\n                    this.tasks.$remove(task);\r\n                },\r\n                removeEmptyTasks: function () {\r\n                    var self = this;\r\n                    $.each(this.tasks, function (key, value) {\r\n                        if (value.count === 0) {\r\n                            setTimeout(function() {\r\n                                self.tasks.$remove(value);\r\n                            }, 0);\r\n                        }\r\n                    });\r\n                },\r\n                parseScannerData: function () {\r\n                    var self = this;\r\n                    setTimeout(function () {\r\n                        var data = parseScanResult(self.scanner_data);\r\n                        $.each(data, function (key, value) {\r\n                            self.tasks.push({\r\n                                label: value.label,\r\n                                ore: value.ore,\r\n                                count: value.count\r\n                            });\r\n                        });\r\n                        self.scanner_data = '';\r\n                    }, 10);\r\n                }\r\n            }\r\n        });\r\n        miningApp.addEmptyTask();\r\n    };\r\n\r\n    $.getJSON('./assets/json/config.json', function (data) {\r\n        configData = data;\r\n        initApp();\r\n    });\r\n\r\n}(jQuery));"],"sourceRoot":"/source/"}